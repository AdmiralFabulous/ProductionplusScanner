[pytest]
# PRODUCTION-SCANNER Test Configuration
# Reference: SUIT_AI_Master_Operations_Manual_v6_8.md

# =============================================================================
# TEST PATHS
# =============================================================================
testpaths = 
    tests/unit
    tests/integration
    tests/e2e
    tests/performance

# =============================================================================
# PYTHON PATH
# =============================================================================
pythonpath = 
    .
    eyeson/backend
    pattern-factory

# =============================================================================
# MARKERS (Reference: Ops Manual v6.8 Section 1.2, 2.5, 2.6)
# =============================================================================
markers =
    # Test Levels
    unit: Unit tests for individual components
    integration: Integration tests between services
    e2e: End-to-end workflow tests
    performance: Load and performance tests
    
    # Component Markers (Reference: Section 1 - The 10 Pillars)
    pillar1: Pillar 1 - The Brain (Agent 0)
    pillar2: Pillar 2 - HQ Functions (Pattern Factory)
    pillar3: Pillar 3 - Holbaazah (Decoy Site)
    pillar4: Pillar 4 - Tailors Platform
    pillar5: Pillar 5 - QC Module
    pillar6: Pillar 6 - Fulfillment & Logistics
    pillar7: Pillar 7 - Dubai Operations
    pillar8: Pillar 8 - Marketing & Acquisition
    pillar9: Pillar 9 - Taxation & Accounting
    pillar10: Pillar 10 - Intelligence
    
    # Feature Markers (Reference: Section 1.2)
    state_machine: 27-State Order Machine tests
    payment: Payment Architecture tests (Section 1.3)
    clawback: Clawback Rail tests (Section 1.4)
    cutter: Cutter Queue tests (Section 2.7)
    nesting: Nesting Algorithm tests (Section 2.8)
    
    # Quality Markers (Reference: Section 2.5, 2.6, 2.7)
    security: Security and authentication tests
    scalability: Scalability and load tests
    resilience: Resilience and fault tolerance tests
    
    # Execution Markers
    slow: Tests that take > 5 seconds
    flaky: Tests with intermittent failures
    smoke: Critical path smoke tests
    critical: Tests for critical business functions

# =============================================================================
# TEST EXECUTION
# =============================================================================
addopts = 
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --color=yes

# Async configuration
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# =============================================================================
# COVERAGE CONFIGURATION
# =============================================================================
[tool:pytest]
# Coverage settings (Reference: Section 13 - Testing Standards)
addopts = 
    --cov=eyeson/backend/src
    --cov=pattern-factory/src
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=80

# Coverage omit patterns
omit = 
    */tests/*
    */test_*
    */venv/*
    */virtualenv/*
    */migrations/*
    */alembic/*
    setup.py

# =============================================================================
# FILTER WARNINGS
# =============================================================================
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning
    default::UserWarning

# =============================================================================
# LOGGING
# =============================================================================
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# =============================================================================
# ENVIRONMENT VARIABLES
# =============================================================================
env = 
    ENVIRONMENT=test
    DEBUG=true
    TESTING=true
    JWT_SECRET_KEY=test-secret-key
    JWT_REFRESH_SECRET_KEY=test-refresh-secret
    DATABASE_URL=postgresql://samedaysuits:test@localhost:5432/samedaysuits_test
    REDIS_URL=redis://localhost:6379/15
    PATTERN_FACTORY_URL=http://localhost:8000
    EYESON_API_URL=http://localhost:8001
    CUTTER_IP=192.168.1.100
    CUTTER_PORT=9100
    CUTTER_AUTO_SUBMIT=false
    TTS_MODEL=kokoro-82m
    STRIPE_API_KEY=sk_test_xxx

# =============================================================================
# TEST COLLECTION
# =============================================================================
norecursedirs = 
    .git
    .tox
    .eggs
    dist
    build
    venv
    virtualenv
    node_modules
    .pytest_cache
    htmlcov
    .coverage
    logs
